% pandoc requires the CSLReferences environment to be defined for bibliographies
% and a breaking change was introduced in pandoc version 3.1.7
% (https://pandoc.org/releases.html#pandoc-3.1.7-2023-08-31)
% so we need to define it differently depending on the pandoc version used
% this is for the newer version of CSLReferences that uses a list environment with bibitems
% commands below were adapted from pandoc 3.2 template (as of May 31, 2024) at
% https://github.com/jgm/pandoc/blob/main/data/templates/default.latex#L384C1-L418C8
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  % \setlength{\itemsep}{#2\baselineskip}}}
  \setlength{\itemsep}{\baselineskip}}} % hard-code single line skip between entries
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

%this is to adjust header and footer in landscaped pages
\fancypagestyle{lscape}{%
    \fancyhf{} % clear all header and footer fields
    \fancyhead[R]{\begin{footnotesize}
    \begin{textblock}{1}(0.7,1.5){\color{gray}\rotatebox{90}{$shorttitle$}}\end{textblock}
    \end{footnotesize} }
    \fancyfoot[L]{\begin{footnotesize}
    \begin{textblock}{1}(21,1.75){\color{gray}\rotatebox{90}{Page \thepage{}~of~\pageref{LastPage}}}\end{textblock}
    \end{footnotesize} }
    \fancyfoot[R]{\begin{footnotesize}
%     \begin{textblock}{19.8}[-0.01,{\DynLength}](1.5,23.20){\color{gray}\rotatebox{90}{\Rver}}\end{textblock}
    \begin{textblock}{19.8}(1.5,23.20){\color{gray}\rotatebox{90}{\Rver}}\end{textblock}
    \end{footnotesize} }
    \setlength{\TPHorizModule}{1cm}
    \setlength{\TPVertModule}{1cm}
    \renewcommand{\headrulewidth}{0.0pt}
    \renewcommand{\footrulewidth}{0.0pt}}

%set header and footer for first page
\renewcommand{\headrulewidth}{0.8pt}
\renewcommand{\footrulewidth}{0.8pt}
\fancyhead[L]{\includegraphics[height=0.8cm]{$logo_path_scharp$}}
$if(dropVISClogo)$
$else$
\fancyhead[C]{\includegraphics[height=0.8cm]{$logo_path_visc$}}
$endif$
\fancyhead[R]{\includegraphics[height=0.8cm]{$logo_path_fh$}}
\fancyfoot[C]{Page \thepage{}~of~\pageref{LastPage}}
\setlength{\headheight}{27pt}

%decrease margins for landscape pages
\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
%\setlength{\listparindent}{\parindent}%
%\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}

% being able to set emphasis for entire table row
\newcommand\setrow[1]{\gdef\rowmac{#1}#1\ignorespaces}
\newcommand\clearrow{\global\let\rowmac\relax}
\clearrow

%page settings
\setlength{\footskip}{56pt}
\pagestyle{fancy}
\setlength{\parindent}{0pt}
